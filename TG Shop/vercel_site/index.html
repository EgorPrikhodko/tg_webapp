<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,viewport-fit=cover"
  />
  <title>TG Shop Â· WebApp</title>
  <!-- Ğ•ÑĞ»Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑˆÑŒ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Telegram, Ğ½ÑƒĞ¶ĞµĞ½ ÑÑ‚Ğ¾Ñ‚ SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #0f1220;
      --card: #171a2b;
      --muted: #20243a;
      --text: #f4f6ff;
      --subtext: #b4b8d0;
      --accent: #5b8cff;
      --ok: #3ad29f;
      --warn: #ffc857;
      --err: #ff6b6b;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font: 14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
    }
    .wrap { max-width: 1120px; margin: 0 auto; padding: 18px; }
    header {
      display: flex; gap: 10px; align-items: center; justify-content: space-between;
      margin-bottom: 14px;
    }
    h1 { font-size: 20px; margin: 0; letter-spacing: .3px; }
    .pill {
      background: var(--muted); padding: 8px 12px; border-radius: 999px; color: var(--subtext);
      display: inline-flex; align-items: center; gap: 8px;
    }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
    .tabs {
      display: flex; gap: 8px; flex-wrap: wrap; margin: 10px 0 0;
    }
    .tab-btn {
      background: var(--muted); color: var(--text); border: none; border-radius: 10px;
      padding: 10px 14px; cursor: pointer; transition: .2s transform, .2s opacity;
    }
    .tab-btn[aria-selected="true"] { background: var(--accent); }
    .grid { display: grid; gap: 14px; }
    @media (min-width: 860px) {
      .grid-2 { grid-template-columns: 1fr 1fr; }
      .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
    }
    .card {
      background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 14px; border: 1px solid rgba(255,255,255,.06);
    }
    .card h2 { margin: 0 0 8px; font-size: 16px; }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .row > * { flex: 1 1 auto; }
    .input, select, textarea {
      width: 100%; background: #0c0f1d; border: 1px solid #2b3150; color: var(--text);
      border-radius: 10px; padding: 10px 12px; outline: none;
    }
    textarea { min-height: 80px; resize: vertical; }
    .btn {
      background: var(--accent); color: #fff; border: none; border-radius: 10px;
      padding: 10px 14px; cursor: pointer; font-weight: 600;
    }
    .btn.muted { background: var(--muted); color: var(--text); }
    .btn.red { background: #ff5c7a; }
    .btn.green { background: var(--ok); color: #05110d; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .table {
      width: 100%; border-collapse: collapse; overflow: hidden; border-radius: 12px;
    }
    .table th, .table td {
      padding: 10px; border-bottom: 1px solid rgba(255,255,255,.06); text-align: left;
      vertical-align: top;
    }
    .table th { color: var(--subtext); font-weight: 600; }
    .badg { padding: 3px 8px; border-radius: 999px; background: var(--muted); color: var(--text); font-size: 12px; }
    .toast {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 18px; background: #11162a; border: 1px solid #253058; color: var(--text);
      padding: 12px 14px; border-radius: 12px; box-shadow: var(--shadow); z-index: 50; display: none;
    }
    .hint { color: var(--subtext); font-size: 12px; }
    .divider { height: 1px; background: rgba(255,255,255,.06); margin: 12px 0; }
    .badge-ok { background: rgba(58,210,159,.18); color: #3ad29f; }
    .badge-err { background: rgba(255,107,107,.2); color: #ff9090; }
    .tag { background: #0f1430; border: 1px solid #28306b; padding: 6px 8px; border-radius: 10px; color: #c5ccff; }
    .code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .sr-only { position: absolute; width: 1px; height: 1px; overflow: hidden; clip: rect(0 0 0 0); white-space: nowrap; clip-path: inset(50%); }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="row" style="gap:12px; align-items: center;">
        <h1>ğŸ›ï¸ TG Shop Â· WebApp</h1>
        <div id="pillStatus" class="pill">
          <span class="status-dot" id="dotDb" style="background: var(--warn)"></span>
          <span id="txtDb">ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ‘Ğ”â€¦</span>
        </div>
        <div class="pill" title="ID Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ">
          ğŸ‘¤ <span id="pillUser">â€”</span>
        </div>
        <div class="pill" title="Ğ ĞµĞ¶Ğ¸Ğ¼">
          <span id="pillMode">Ğ“Ğ¾ÑÑ‚ÑŒ</span>
        </div>
      </div>
      <div class="row" style="justify-content: flex-end; gap:8px; max-width: 520px;">
        <input id="apiInput" class="input" placeholder="API Base (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)" />
        <button id="saveApiBtn" class="btn muted">Set API</button>
      </div>
    </header>

    <nav class="tabs">
      <button class="tab-btn" id="tab_catalog" aria-selected="true">ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³</button>
      <button class="tab-btn" id="tab_admin" aria-selected="false" style="display:none">ĞĞ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ</button>
    </nav>

    <!-- ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ -->
    <section id="view_catalog" class="grid" style="margin-top:12px;">
      <div class="card">
        <h2>ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸</h2>
        <div class="row">
          <button class="btn muted" id="btnReloadCats">ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº</button>
          <span class="hint">ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ GET: <span class="code tag">/api/categories</span></span>
        </div>
        <div class="divider"></div>
        <div id="catsEmpty" class="hint">ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹â€¦</div>
        <table class="table" id="catsTable" style="display:none">
          <thead>
            <tr>
              <th>ID</th><th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th><th>Slug</th><th>Parent</th>
            </tr>
          </thead>
          <tbody id="catsTbody"></tbody>
        </table>
      </div>

      <div class="card">
        <h2>Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹</h2>
        <div class="row">
          <input id="qSearch" class="input" placeholder="ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ/Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñâ€¦" />
          <select id="selCatFilter" class="input">
            <option value="">â€” ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ â€”</option>
          </select>
          <button class="btn muted" id="btnReloadProds">ĞĞ°Ğ¹Ñ‚Ğ¸</button>
        </div>
        <div class="divider"></div>
        <div id="prodsEmpty" class="hint">Ğ¢Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚â€¦</div>
        <table class="table" id="prodsTable" style="display:none">
          <thead>
            <tr>
              <th>ID</th><th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th><th>Ğ¦ĞµĞ½Ğ°</th><th>Ğ’Ğ°Ğ».</th><th>ĞÑÑ‚Ğ°Ñ‚Ğ¾Ğº</th><th>ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½</th><th>ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</th>
            </tr>
          </thead>
          <tbody id="prodsTbody"></tbody>
        </table>
      </div>
    </section>

    <!-- ĞĞ´Ğ¼Ğ¸Ğ½ -->
    <section id="view_admin" class="grid grid-2" style="margin-top:12px; display:none">
      <div class="card">
        <h2>ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Â· CRUD</h2>
        <div class="row">
          <input id="catName" class="input" placeholder="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: ĞĞ±ÑƒĞ²ÑŒ)" />
          <input id="catSlug" class="input" placeholder="slug (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: shoes)" />
          <input id="catParent" class="input" placeholder="parent_id (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)" />
        </div>
        <div class="row" style="margin-top:8px">
          <button id="btnCreateCat" class="btn">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ</button>
          <button id="btnUpdateCat" class="btn green" disabled>Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
          <button id="btnCancelCat" class="btn muted" disabled>ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
        </div>
        <div class="divider"></div>
        <div id="catsEmptyA" class="hint">ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹â€¦</div>
        <table class="table" id="catsTableA" style="display:none">
          <thead>
            <tr><th>ID</th><th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th><th>Slug</th><th>Parent</th><th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th></tr>
          </thead>
          <tbody id="catsTbodyA"></tbody>
        </table>
      </div>

      <div class="card">
        <h2>Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹ Â· CRUD</h2>
        <div class="grid">
          <div class="row">
            <input id="pTitle" class="input" placeholder="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ (ĞšÑ€Ğ¾ÑÑĞ¾Ğ²ĞºĞ¸)"/>
            <input id="pSlug" class="input" placeholder="slug (sneakers)"/>
          </div>
          <textarea id="pDesc" class="input" placeholder="ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (Ğ¾Ğ¿Ñ†.)"></textarea>
          <div class="row">
            <input id="pPrice" class="input" type="number" min="0" step="0.01" placeholder="Ğ¦ĞµĞ½Ğ°"/>
            <input id="pCurr" class="input" placeholder="Ğ’Ğ°Ğ»ÑÑ‚Ğ° (RUB)" value="RUB"/>
            <input id="pStock" class="input" type="number" min="0" step="1" placeholder="ĞÑÑ‚Ğ°Ñ‚Ğ¾Ğº" value="0"/>
          </div>
          <div class="row">
            <select id="pCat" class="input"><option value="">â€” ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ â€”</option></select>
            <select id="pActive" class="input">
              <option value="true" selected>ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½</option>
              <option value="false">Ğ¡ĞºÑ€Ñ‹Ñ‚</option>
            </select>
          </div>
          <textarea id="pImages" class="input" placeholder='Ğ¡ÑÑ‹Ğ»ĞºĞ¸ Ğ½Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ (Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ Ğ² ÑÑ‚Ñ€Ğ¾ĞºĞµ)'></textarea>
          <textarea id="pAttrs" class="input" placeholder='ĞÑ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ñ‹ JSON: {"brand":"Nike","size":"42"}'></textarea>
          <div class="row">
            <button id="btnCreateProd" class="btn">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ</button>
            <button id="btnUpdateProd" class="btn green" disabled>Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
            <button id="btnCancelProd" class="btn muted" disabled>ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
          </div>
        </div>

        <div class="divider"></div>
        <div id="prodsEmptyA" class="hint">ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²â€¦</div>
        <table class="table" id="prodsTableA" style="display:none">
          <thead>
            <tr><th>ID</th><th>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</th><th>Ğ¦ĞµĞ½Ğ°</th><th>Ğ’Ğ°Ğ».</th><th>ĞÑÑ‚.</th><th>ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½</th><th>ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</th><th>Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ</th></tr>
          </thead>
          <tbody id="prodsTbodyA"></tbody>
        </table>
      </div>
    </section>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // âš™ï¸ ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ API:
    // 1) ĞŸĞ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ğ±ĞµÑ€Ñ‘Ğ¼ Ğ¸Ğ· query-Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ° ?api=... , Ğ¸Ğ½Ğ°Ñ‡Ğµ local fallback.
    // 2) ĞœĞ¾Ğ¶ĞµÑˆÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ²Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑ Ğ±ÑĞºĞ° Ğ² Ğ¿Ğ¾Ğ»Ğµ ÑĞ¿Ñ€Ğ°Ğ²Ğ° Ğ¸ Ğ½Ğ°Ğ¶Ğ°Ñ‚ÑŒ "Set API".
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const url = new URL(location.href);
    const qpApi = url.searchParams.get("api");
    const API_BASE = (() => {
      if (qpApi) return qpApi.replace(/\/+$/, "");
      // â¬‡ï¸ Ğ—ĞĞœĞ•ĞĞ˜ Ğ­Ğ¢Ğ, ĞµÑĞ»Ğ¸ Ñƒ Ñ‚ĞµĞ±Ñ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ¿Ğ¾Ñ€Ñ‚/Ğ´Ğ¾Ğ¼ĞµĞ½ Ğ±ÑĞºĞµĞ½Ğ´Ğ°
      // ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ´Ğ»Ñ ngrok: https://<subdomain>.ngrok-free.app
      return "http://127.0.0.1:9010";
    })();

    const els = {
      dotDb: document.getElementById("dotDb"),
      txtDb: document.getElementById("txtDb"),
      pillUser: document.getElementById("pillUser"),
      pillMode: document.getElementById("pillMode"),
      apiInput: document.getElementById("apiInput"),
      saveApiBtn: document.getElementById("saveApiBtn"),
      tabCatalog: document.getElementById("tab_catalog"),
      tabAdmin: document.getElementById("tab_admin"),
      viewCatalog: document.getElementById("view_catalog"),
      viewAdmin: document.getElementById("view_admin"),
      toast: document.getElementById("toast"),

      // catalog lists
      catsEmpty: document.getElementById("catsEmpty"),
      catsTable: document.getElementById("catsTable"),
      catsTbody: document.getElementById("catsTbody"),
      prodsEmpty: document.getElementById("prodsEmpty"),
      prodsTable: document.getElementById("prodsTable"),
      prodsTbody: document.getElementById("prodsTbody"),
      btnReloadCats: document.getElementById("btnReloadCats"),
      btnReloadProds: document.getElementById("btnReloadProds"),
      qSearch: document.getElementById("qSearch"),
      selCatFilter: document.getElementById("selCatFilter"),

      // admin cats
      catsEmptyA: document.getElementById("catsEmptyA"),
      catsTableA: document.getElementById("catsTableA"),
      catsTbodyA: document.getElementById("catsTbodyA"),
      catName: document.getElementById("catName"),
      catSlug: document.getElementById("catSlug"),
      catParent: document.getElementById("catParent"),
      btnCreateCat: document.getElementById("btnCreateCat"),
      btnUpdateCat: document.getElementById("btnUpdateCat"),
      btnCancelCat: document.getElementById("btnCancelCat"),

      // admin prods
      prodsEmptyA: document.getElementById("prodsEmptyA"),
      prodsTableA: document.getElementById("prodsTableA"),
      prodsTbodyA: document.getElementById("prodsTbodyA"),
      pTitle: document.getElementById("pTitle"),
      pSlug: document.getElementById("pSlug"),
      pDesc: document.getElementById("pDesc"),
      pPrice: document.getElementById("pPrice"),
      pCurr: document.getElementById("pCurr"),
      pStock: document.getElementById("pStock"),
      pCat: document.getElementById("pCat"),
      pActive: document.getElementById("pActive"),
      pImages: document.getElementById("pImages"),
      pAttrs: document.getElementById("pAttrs"),
      btnCreateProd: document.getElementById("btnCreateProd"),
      btnUpdateProd: document.getElementById("btnUpdateProd"),
      btnCancelProd: document.getElementById("btnCancelProd"),
    };

    els.apiInput.value = API_BASE;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Telegram WebApp: Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ tg_id, ĞµÑĞ»Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ Ğ² Telegram
    // Ğ”Ğ»Ñ dev-Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°: ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ Telegram, ÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ¼ tg_id Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·.
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let tgId = null;
    try {
      if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe?.user?.id) {
        tgId = Telegram.WebApp.initDataUnsafe.user.id;
      }
    } catch (e) {}
    if (!tgId) {
      const stored = localStorage.getItem("debug_tg_id");
      if (stored) {
        tgId = parseInt(stored, 10);
      } else {
        const fromPrompt = prompt("Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ Telegram ID (Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°). ĞÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼ Ğ´Ğ»Ñ Ğ³Ğ¾ÑÑ‚Ñ:", "");
        if (fromPrompt && /^\d+$/.test(fromPrompt)) {
          tgId = parseInt(fromPrompt, 10);
          localStorage.setItem("debug_tg_id", String(tgId));
        }
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ API
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function headers(json = true, withTg = false) {
      const h = {};
      if (json) h["Content-Type"] = "application/json";
      if (withTg && tgId) h["X-Telegram-Id"] = String(tgId);
      return h;
    }
    async function apiGet(path, params = undefined) {
      const url = new URL(API_BASE + path);
      if (params) Object.entries(params).forEach(([k, v]) => (v ?? v === 0) && url.searchParams.set(k, v));
      const r = await fetch(url, { method: "GET" });
      if (!r.ok) throw new Error(await r.text());
      return r.json();
    }
    async function apiSend(method, path, body = null, withTg = false) {
      const r = await fetch(API_BASE + path, {
        method,
        headers: headers(true, withTg),
        body: body ? JSON.stringify(body) : null,
      });
      if (!r.ok) throw new Error(await r.text());
      return r.json();
    }
    function toast(msg, tone = "info") {
      els.toast.textContent = msg;
      els.toast.style.display = "block";
      els.toast.style.borderColor = tone === "err" ? "#ff6b6b" : tone === "ok" ? "#3ad29f" : "#253058";
      setTimeout(() => (els.toast.style.display = "none"), 2200);
    }
    function setDbStatus(ok) {
      els.dotDb.style.background = ok ? "var(--ok)" : "var(--err)";
      els.txtDb.textContent = ok ? "Ğ‘Ğ”: ok" : "Ğ‘Ğ”: failed";
    }
    function setUserPills({ isAdmin }) {
      els.pillUser.textContent = tgId ? String(tgId) : "â€”";
      els.pillMode.textContent = isAdmin ? "ĞĞ´Ğ¼Ğ¸Ğ½" : "Ğ“Ğ¾ÑÑ‚ÑŒ";
      els.pillMode.className = "pill " + (isAdmin ? "badge-ok" : "");
      els.tabAdmin.style.display = isAdmin ? "inline-flex" : "none";
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ: /health + /api/users/ensure â†’ ÑƒĞ·Ğ½Ğ°Ñ‘Ğ¼ Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ğ»Ğ¸ user
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function init() {
      try {
        const h = await apiGet("/health");
        setDbStatus(h.database === "ok");
      } catch {
        setDbStatus(false);
      }

      let isAdmin = false;
      if (tgId) {
        try {
          const u = await apiSend("POST", "/api/users/ensure", { tg_id: tgId }, true);
          isAdmin = !!u.is_admin;
        } catch (e) {
          console.warn("ensure_user failed:", e);
        }
      }
      setUserPills({ isAdmin });

      // ĞŸĞ¾Ğ´Ñ‚ÑĞ½ÑƒÑ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°
      await Promise.all([refreshCategories(), refreshProducts()]);
      // Ğ˜ Ğ² Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ…
      await refreshAdminData();

      // ĞĞ°Ğ²ĞµÑĞ¸Ğ¼ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸
      bindHandlers();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³: ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function refreshCategories() {
      const list = await apiGet("/api/categories");
      renderCats(list, els.catsTbody, els.catsTable, els.catsEmpty);
      // select Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°
      els.selCatFilter.innerHTML = `<option value="">â€” ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ â€”</option>` + list.map(c => `<option value="${c.id}">${escapeHtml(c.name)} (#${c.id})</option>`).join("");
      return list;
    }
    function renderCats(list, tbody, tableEl, emptyEl) {
      if (!list.length) {
        tableEl.style.display = "none";
        emptyEl.style.display = "block";
        tbody.innerHTML = "";
        return;
      }
      tableEl.style.display = "table";
      emptyEl.style.display = "none";
      tbody.innerHTML = list.map(c => `
        <tr>
          <td>${c.id}</td>
          <td>${escapeHtml(c.name || "")}</td>
          <td><span class="tag code">${escapeHtml(c.slug)}</span></td>
          <td>${c.parent_id ?? ""}</td>
        </tr>
      `).join("");
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³: Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function refreshProducts() {
      const params = {};
      const q = els.qSearch.value.trim();
      if (q) params.q = q;
      const catId = els.selCatFilter.value.trim();
      if (catId) params.category_id = catId;
      const list = await apiGet("/api/products", params);
      renderProds(list, els.prodsTbody, els.prodsTable, els.prodsEmpty);
      return list;
    }
    function renderProds(list, tbody, tableEl, emptyEl) {
      if (!list.length) {
        tableEl.style.display = "none";
        emptyEl.style.display = "block";
        tbody.innerHTML = "";
        return;
      }
      tableEl.style.display = "table";
      emptyEl.style.display = "none";
      tbody.innerHTML = list.map(p => `
        <tr>
          <td>${p.id}</td>
          <td>${escapeHtml(p.title)}</td>
          <td>${Number(p.price).toFixed(2)}</td>
          <td>${escapeHtml(p.currency || "")}</td>
          <td>${p.stock ?? 0}</td>
          <td>${p.is_active ? "Ğ”Ğ°" : "ĞĞµÑ‚"}</td>
          <td>${p.category_id}</td>
        </tr>
      `).join("");
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ĞĞ´Ğ¼Ğ¸Ğ½: Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ + Ñ„Ğ¾Ñ€Ğ¼Ñ‹
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let editingCatId = null;
    async function refreshAdminData() {
      const cats = await apiGet("/api/categories");
      renderAdminCats(cats);
      // Ğ´Ğ»Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² â€” ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
      els.pCat.innerHTML = `<option value="">â€” ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ â€”</option>` + cats.map(c => `<option value="${c.id}">${escapeHtml(c.name)} (#${c.id})</option>`).join("");
      // ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
      const prods = await apiGet("/api/products");
      renderAdminProds(prods);
    }
    function renderAdminCats(list) {
      if (!list.length) {
        els.catsTableA.style.display = "none";
        els.catsEmptyA.style.display = "block";
        els.catsTbodyA.innerHTML = "";
        return;
      }
      els.catsTableA.style.display = "table";
      els.catsEmptyA.style.display = "none";
      els.catsTbodyA.innerHTML = list.map(c => `
        <tr>
          <td>${c.id}</td>
          <td>${escapeHtml(c.name||"")}</td>
          <td><span class="tag code">${escapeHtml(c.slug)}</span></td>
          <td>${c.parent_id ?? ""}</td>
          <td class="row" style="gap:6px">
            <button class="btn muted" data-act="editCat" data-id="${c.id}">âœï¸</button>
            <button class="btn red" data-act="delCat" data-id="${c.id}">ğŸ—‘ï¸</button>
          </td>
        </tr>
      `).join("");
      els.catsTbodyA.querySelectorAll("button[data-act]").forEach(btn=>{
        btn.addEventListener("click", async (ev)=>{
          const id = parseInt(btn.dataset.id,10);
          const act = btn.dataset.act;
          if (act === "editCat") {
            const c = list.find(x=>x.id===id); if (!c) return;
            editingCatId = id;
            els.catName.value = c.name || "";
            els.catSlug.value = c.slug || "";
            els.catParent.value = c.parent_id ?? "";
            els.btnUpdateCat.disabled = false;
            els.btnCancelCat.disabled = false;
            els.btnCreateCat.disabled = true;
          } else if (act === "delCat") {
            if (!confirm(`Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ #${id}?`)) return;
            try {
              await fetch(API_BASE + `/api/categories/${id}`, { method:"DELETE", headers: headers(false, true) });
              toast("ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°","ok");
              await Promise.all([refreshAdminData(), refreshCategories()]);
            } catch (e) { toast("ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸","err"); }
          }
        });
      });
    }
    els.btnCreateCat.addEventListener("click", async ()=>{
      const payload = {
        name: els.catName.value.trim(),
        slug: els.catSlug.value.trim(),
        parent_id: els.catParent.value.trim() ? Number(els.catParent.value.trim()) : null
      };
      if (!payload.name || !payload.slug) return toast("Ğ£ĞºĞ°Ğ¶Ğ¸ name Ğ¸ slug","err");
      try {
        const r = await apiSend("POST","/api/categories", payload, true);
        toast(`Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ #${r.id}`, "ok");
        els.catName.value = els.catSlug.value = els.catParent.value = "";
        await Promise.all([refreshAdminData(), refreshCategories()]);
      } catch (e) { toast("ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸","err"); }
    });
    els.btnUpdateCat.addEventListener("click", async ()=>{
      if (!editingCatId) return;
      const payload = {
        name: els.catName.value.trim(),
        slug: els.catSlug.value.trim(),
        parent_id: els.catParent.value.trim() ? Number(els.catParent.value.trim()) : null
      };
      try {
        const r = await apiSend("PATCH", `/api/categories/${editingCatId}`, payload, true);
        toast(`Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾ #${r.id}`, "ok");
        editingCatId = null;
        els.btnUpdateCat.disabled = true; els.btnCancelCat.disabled = true; els.btnCreateCat.disabled = false;
        els.catName.value = els.catSlug.value = els.catParent.value = "";
        await Promise.all([refreshAdminData(), refreshCategories()]);
      } catch (e) { toast("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸","err"); }
    });
    els.btnCancelCat.addEventListener("click", ()=>{
      editingCatId = null;
      els.btnUpdateCat.disabled = true; els.btnCancelCat.disabled = true; els.btnCreateCat.disabled = false;
      els.catName.value = els.catSlug.value = els.catParent.value = "";
    });

    // Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹
    let editingProdId = null;
    function renderAdminProds(list) {
      if (!list.length) {
        els.prodsTableA.style.display = "none";
        els.prodsEmptyA.style.display = "block";
        els.prodsTbodyA.innerHTML = "";
        return;
      }
      els.prodsTableA.style.display = "table";
      els.prodsEmptyA.style.display = "none";
      els.prodsTbodyA.innerHTML = list.map(p => `
        <tr>
          <td>${p.id}</td>
          <td>${escapeHtml(p.title)}</td>
          <td>${Number(p.price).toFixed(2)}</td>
          <td>${escapeHtml(p.currency||"")}</td>
          <td>${p.stock ?? 0}</td>
          <td>${p.is_active ? "Ğ”Ğ°" : "ĞĞµÑ‚"}</td>
          <td>${p.category_id}</td>
          <td class="row" style="gap:6px">
            <button class="btn muted" data-act="editProd" data-id="${p.id}">âœï¸</button>
            <button class="btn red" data-act="delProd" data-id="${p.id}">ğŸ—‘ï¸</button>
          </td>
        </tr>
      `).join("");
      els.prodsTbodyA.querySelectorAll("button[data-act]").forEach(btn=>{
        btn.addEventListener("click", async ()=>{
          const id = parseInt(btn.dataset.id,10);
          const act = btn.dataset.act;
          if (act==="editProd") {
            const p = list.find(x=>x.id===id); if (!p) return;
            editingProdId = id;
            els.pTitle.value = p.title || "";
            els.pSlug.value = p.slug || "";
            els.pDesc.value = p.description || "";
            els.pPrice.value = String(p.price ?? 0);
            els.pCurr.value = p.currency || "RUB";
            els.pStock.value = String(p.stock ?? 0);
            els.pCat.value = String(p.category_id ?? "");
            els.pActive.value = p.is_active ? "true" : "false";
            els.pImages.value = Array.isArray(p.images) ? p.images.join("\n") : "";
            els.pAttrs.value = p.attributes ? JSON.stringify(p.attributes, null, 2) : "";
            els.btnCreateProd.disabled = true; els.btnUpdateProd.disabled = false; els.btnCancelProd.disabled = false;
          } else if (act==="delProd") {
            if (!confirm(`Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€ #${id}?`)) return;
            try {
              await fetch(API_BASE + `/api/products/${id}`, { method:"DELETE", headers: headers(false, true) });
              toast("Ğ¢Ğ¾Ğ²Ğ°Ñ€ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½","ok");
              await refreshAdminData();
              await refreshProducts();
            } catch (e) { toast("ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°","err"); }
          }
        });
      });
    }
    els.btnCreateProd.addEventListener("click", async ()=>{
      const payload = collectProdPayload();
      if (!payload) return;
      try {
        const r = await apiSend("POST","/api/products", payload, true);
        toast(`Ğ¢Ğ¾Ğ²Ğ°Ñ€ #${r.id} ÑĞ¾Ğ·Ğ´Ğ°Ğ½`,"ok");
        clearProdForm();
        await refreshAdminData();
        await refreshProducts();
      } catch (e) { toast("ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°","err"); }
    });
    els.btnUpdateProd.addEventListener("click", async ()=>{
      if (!editingProdId) return;
      const payload = collectProdPayload(); if (!payload) return;
      try {
        const r = await apiSend("PATCH", `/api/products/${editingProdId}`, payload, true);
        toast(`Ğ¢Ğ¾Ğ²Ğ°Ñ€ #${r.id} ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½`,"ok");
        editingProdId = null;
        els.btnCreateProd.disabled = false; els.btnUpdateProd.disabled = true; els.btnCancelProd.disabled = true;
        clearProdForm();
        await refreshAdminData();
        await refreshProducts();
      } catch (e) { toast("ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°","err"); }
    });
    els.btnCancelProd.addEventListener("click", ()=>{
      editingProdId = null;
      els.btnCreateProd.disabled = false; els.btnUpdateProd.disabled = true; els.btnCancelProd.disabled = true;
      clearProdForm();
    });

    function collectProdPayload() {
      const title = els.pTitle.value.trim();
      const slug = els.pSlug.value.trim();
      const category_id = parseInt(els.pCat.value, 10);
      if (!title || !slug || !category_id) { toast("Ğ£ĞºĞ°Ğ¶Ğ¸ title, slug Ğ¸ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ","err"); return null; }
      let price = parseFloat(els.pPrice.value || "0");
      if (Number.isNaN(price) || price < 0) price = 0;
      const stock = parseInt(els.pStock.value || "0", 10);
      const images = els.pImages.value.trim()
        ? els.pImages.value.split("\n").map(s=>s.trim()).filter(Boolean)
        : null;
      let attributes = null;
      const rawAttrs = els.pAttrs.value.trim();
      if (rawAttrs) {
        try { attributes = JSON.parse(rawAttrs); }
        catch { toast("ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ JSON Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ²","err"); return null; }
      }
      return {
        title,
        slug,
        description: els.pDesc.value.trim() || null,
        price,
        currency: (els.pCurr.value || "RUB").toUpperCase(),
        stock: Number.isFinite(stock) ? stock : 0,
        is_active: els.pActive.value === "true",
        images,
        attributes,
        category_id,
      };
    }
    function clearProdForm() {
      els.pTitle.value = els.pSlug.value = els.pDesc.value = "";
      els.pPrice.value = ""; els.pCurr.value = "RUB"; els.pStock.value = "0";
      els.pCat.value = ""; els.pActive.value = "true";
      els.pImages.value = ""; els.pAttrs.value = "";
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ¿Ñ€Ğ¾Ñ‡ĞµĞµ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function bindHandlers() {
      els.tabCatalog.addEventListener("click", ()=>{
        els.tabCatalog.setAttribute("aria-selected","true");
        els.tabAdmin.setAttribute("aria-selected","false");
        els.viewCatalog.style.display = "";
        els.viewAdmin.style.display = "none";
      });
      els.tabAdmin.addEventListener("click", ()=>{
        els.tabCatalog.setAttribute("aria-selected","false");
        els.tabAdmin.setAttribute("aria-selected","true");
        els.viewCatalog.style.display = "none";
        els.viewAdmin.style.display = "";
      });
      els.btnReloadCats.addEventListener("click", refreshCategories);
      els.btnReloadProds.addEventListener("click", refreshProducts);
      els.saveApiBtn.addEventListener("click", ()=>{
        const v = els.apiInput.value.trim();
        if (!v) return toast("Ğ£ĞºĞ°Ğ¶Ğ¸ API Base URL","err");
        const u = new URL(location.href);
        u.searchParams.set("api", v);
        location.href = u.toString();
      });
    }
    function escapeHtml(s) {
      return String(s).replace(/[&<>"'`]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'}[c]));
    }

    // go
    init();
  </script>
</body>
</html>
